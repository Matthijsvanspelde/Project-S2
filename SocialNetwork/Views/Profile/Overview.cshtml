@model SocialNetwork.ViewModels.ProfileViewModel
@using Microsoft.AspNetCore.Http

@{
	ViewData["Title"] = "Profile";
}

<script language="javascript" type='text/javascript'>
	function ShowDivFollowers() {
		if (document.getElementById('Popup').style.visibility = 'hidden') {
			document.getElementById('Popup').style.visibility = 'visible';
		}
	}

	function HideDivFollowers() {
		if (document.getElementById('Popup').style.visibility = 'visible') {
			document.getElementById('Popup').style.visibility = 'hidden';
		}
	}
</script>
<div id="Popup" class="popup-container">
	<div class="FollowerPopup">
		<div class="popup-action">
			<a onclick="javascript:HideDivFollowers()" href="#?Followers">&#10006;</a>
		</div>
		<div class="follower-header">
			<a>Followers (@Model.Followers.Count)</a>
		</div>
		<div class="follower-overflow">
			@foreach (var item in Model.Followers)
			{
				<div class="follower">
					<a asp-controller="Profile" asp-action="SearchedProfile" asp-route-id="@item.Id" class="username">
						@item.Firstname
						@item.Middlename
						@item.Lastname
					</a>
				</div>
			}
		</div>
	</div>
</div>


<partial name="_Menu">
	<div class="content-wrapper">
		
		<div class="profile-left-wrapper">
			<div class="UserPortrait">
				<div class="username-display">
					<div class="profile-picture">
						@if (Model.Img != null)
						{
							<img src="data:image;base64,@Convert.ToBase64String(Model.Img)" />
						}
						else
						{

							<img src="~/images/defaultProfilePicture.jpg" />
						}
					</div>
					<p>
						@Html.DisplayFor(model => model.Firstname)
						@Html.DisplayFor(model => model.Middlename)
						@Html.DisplayFor(model => model.Lastname)
					</p>
				</div>
				
				<p style="color: grey; font-size: 14px">Birthday</p>
				<p style="margin-bottom: 26px;">@Html.DisplayFor(model => model.Birthdate)</p>
				<p style="color: grey; font-size: 14px">Country</p>
				<p style="margin-bottom: 26px;">@Html.DisplayFor(model => model.Country)</p>
				<p style="color: grey; font-size: 14px">City</p>
				<p style="margin-bottom: 26px;">@Html.DisplayFor(model => model.City)</p>
				<p style="color: grey; font-size: 14px">About @Html.DisplayFor(model => model.Firstname)</p>
				<p style="margin-bottom: 26px; line-height: 16px;">@Html.DisplayFor(model => model.Biography)</p>
				
					@if (Model.Id == Context.Session.GetInt32("Id"))
					{
						<div class="profileaction">
							@Html.ActionLink("Edit profile", "Edit")<br />
						</div>
					}
					else
					{
						if (Model.Requested == false)
						{
							if (Model.Added == false)
							{
								<div class="profileaction">
									<a asp-controller="Profile" asp-action="SendFriendRequest" asp-route-RecieverId="@Model.Id">Follow</a>
								</div>
							}
							else
							{
								<div class="profileaction-frozen">
									<a style="color: #ffffff;">Following</a>
								</div>
							}
						}
						else if (Model.Requested == true)
						{
							<div class="profileaction-frozen">
								<a style="color: #ffffff;">Requested</a>
							</div>
						}
					}
				
			</div>
			<div class="follower-container">
				<div class="follower-header">
					<a>Followers (@Model.Followers.Count)</a>
				</div>
					<div class="popup-toggle" onclick="javascript:ShowDivFollowers()" href="#?Followers">Show followers</div>
			</div>
		</div>

		@if (Model.Id == Context.Session.GetInt32("Id"))
		{
			<div class="newpost">
				@Html.ActionLink("Post something", "Post")<br />
			</div>
		}
		@foreach (var item in Model.Posts)
		{
			<div class="post-container">

				<div class="postheader">
					<a>@item.Firstname @item.Middlename @item.Lastname</a><br />
					<a class="posttime">@item.Posted</a>
				</div>

				<div class="postmessage">
					<a class="posttitle">@item.Title</a><br />
					<a>@item.Message</a>
				</div>
				<div class="postimage">
					<img src="data:image;base64,@Convert.ToBase64String(item.Image)">
				</div>
				<div class="likecontainer">
					<a class="likeBtn" asp-controller="Profile" asp-action="LikePost" asp-route-PostId="@item.PostId">Like</a>
					<a class="postlikes">@item.Likes Like(s)</a>
					<br />
				</div>
			</div>
		}
	</div>
